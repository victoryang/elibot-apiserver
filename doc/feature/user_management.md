### 1. 需求背景
#### 1.1. 目前工业版用户管理现状
- 用户名 == 权限，用户名决定权限
- 用户与权限
 - 普通用户：仅允许运行操作，禁止修改操作(包括新建、编辑程序等动作)
 - 一般用户：禁止修改系统参数、系统配置(工艺与通信)
 - 专家用户：禁止部分系统参数
 - 管理员：&emsp;HMI端所有操作

#### 1.2. 业界协作版用户管理现状(业界某公司版)
- 用户与权限
 - 可创建多个用户
 - 创建用户时，需要指定用户的身份信息
 - 身份信息和登陆状态，决定当前用户拥有的权限
 - 用户的权限决定页面显示
- 页面显示分级
   - Logout
   - Operator
   - Admin

&emsp;基于协作机器人示教器需要支持多用户，区分用户、身份以及权限等特性，以提供更加丰富的用户管理特性

&emsp;决定在方案1.2的基础上, 实现协作机器人的用户管理模块

### 2. 需求分析
#### 2.1. 需求规格
- 用户
 - 用户名
 - ID
 - 密码
 - 身份
 - 邮箱

- Role
 - Operator
 - Admin

#### 2.2. 需求分解
##### 2.2.1 前端界面分解
- 用户管理界面
 - 用户管理界面入口
 - 用户列表显示
 - 用户添加、删除和编辑入口
- 用户添加界面
 - 
- 用户删除界面
 - 
- 用户编辑界面
 - 
- 登陆和登出界面
 - 登陆和登出界面入口
 - 用户登陆界面
 - 用户登出界面
- 锁屏界面
 - 锁屏模式入口
 - 锁屏登陆界面

##### 2.2.2 后端服务分解
- 用户管理模块
 - 用户数据管理
 - 用户操作管理

- 登陆和权限管理模块
 - 登陆管理
 - 权限管理

#### 2.3 需求功能
##### 2.3.1. 前端需求功能
##### 2.3.1.1. 用户管理界面
- 用户管理界面入口
 - 在management/settings内，添加用户管理界面的入口
- 用户列表显示
 - 用户搜索栏 //Optional
 - 显示当前已创建用户的列表
 - 支持分页等对用户列表的操作
- 用户添加、删除和编辑入口
 - 当前用户管理界面不退出，弹出的界面获取用户焦点
 - 用户操作完成或取消后，返回当前界面
- Demo

![用户管理](/uploads/025ee071f686a125230f1ffc47c7f46f/用户管理.jpg)

##### 2.3.1.2. 用户添加界面
- 输入用户规格数据
- 根据相关规则确定创建用户是否成功
- Demo

![添加用户](/uploads/439454333254c106881e9cd48bfbe41f/添加用户.jpg)

##### 2.3.1.3. 用户删除界面
- Double check
- 输入需要删除的用户名及密码
- 根据相关规则确定删除用户是否成功
- Demo

![删除用户](/uploads/dcc6dd31f9eb99de323b9d78a95622d9/删除用户.jpg)

##### 2.3.1.4. 用户编辑界面
- 输入用户规格数据
- 根据相关规则确定编辑用户是否成功
- Demo

![编辑用户](/uploads/75e95fdad192748cfc41a3a0a55dee8e/编辑用户.jpg)

##### 2.3.1.5. 登陆和登出界面
- 登陆和登出界面入口
 - 在屏幕右上角，加入登陆和登出界面的入口
 - 当用户处于登入或者登出时，入口处图标需适配
- 用户登陆界面
 - 用户处于登出状态
 - 允许用户输入用户名和密码
 - login确认条处于enable状态
- 用户登出界面
 - 用户处于登陆状态
 - 不允许用户输入用户名和密码
 - login确认条处于disable状态
- Demo

![用户已登录_](/uploads/fb7609039ebd87d27917eae5619cd46f/用户已登录_.jpg)
![用户未登录](/uploads/30a454f4f4e8dd3338144fb037e04004/用户未登录.jpg)

##### 2.3.1.6. 锁屏界面
- 锁屏模式入口
 - 入口设置位置 //TODO 
 - 用户处于登陆模式时显示锁屏入口，处于登出状态时不显示
 - 进入锁屏模式，当前用户保持登入状态，界面被锁定
- 锁屏登陆界面
 - 进入锁屏登陆界面，显示当前登陆用户，且不可更改，允许用户输入密码进行登入，或者选择注销登出
 - 成功
- Demo

![锁屏](/uploads/c7ea0accc3444d0c83faa9bc68c5879b/锁屏.jpg)

##### 2.3.2. 后端需求功能
##### 2.3.2.1. 用户管理模块
- 用户数据管理

User table

| name        | ID          | Password    | Role        | Mailbox     |
| ----------- | ----------- | ----------- | ----------- | ----------- |
| abc         | 123         | xxxxxx      | Operater    | xxxxxx      |
| def         | 456         | xxxxxx      | Admin       | xxxxxx      |

- 用户操作管理
 - 用户列表获取
 - 添加用户
 - 删除用户
 - 更改用户信息

##### 2.3.2.2. 登陆和权限管理模块
##### 2.3.2.2.1. 登陆管理
- 用户使用username和password请求登陆
 - 验证未通过，返回验证未通过
 - 验证通过则产生临时登陆凭证(如token)返回给客户端
 - 已登陆用户必须携带此凭证发送后续请求
 - 记录当前已产生token的请求信息

- Token table --local

| User ID     | Token    | Source   |
| ----------- | -------- | -------- |
| 123         | xxxxxx   | x.x.x.x  |

- Token table --remote

| User ID     | Token    | Source   |
| ----------- | -------- | -------- |
| 456         | xxxxxx   | x.x.x.x  |
| 789         | xxxxxx   | x.x.x.x  |

##### 2.3.2.2.2. 权限管理
- remote mode
 - 状态关机不保持，开机此功能默认关闭
 - 非登录用户不可开启此功能
 - 非本地请求不可开启此功能
 - 非admin用户不可开启此功能
 - 本地用户登出时，此功能必须设置为关闭状态
 - 此功能开启后，允许远端请求进行后续操作
- 根据source ip获取当前记录的登陆状态
- token验证


### 3. 遗留问题
- 已添加用户是否可以修改账户类型